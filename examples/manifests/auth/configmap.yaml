# This ConfigMap is dynamically generated by setup-secrets.sh
# Template for consumer authentication configuration
# The actual ConfigMap is created with the correct cluster name during deployment
#
# To deploy with a custom cluster name:
#   export CLUSTER_NAME=your-cluster-name
#   make deploy-consumer
#
# Default cluster name: openshift.local (consistent with ptp-operator)
apiVersion: v1
kind: ConfigMap
metadata:
  name: consumer-auth-config
  namespace: cloud-events
data:
  config.json: |
    {
      "enableMTLS": true,
      "useServiceCA": true,
      "clientCertPath": "/etc/cloud-event-consumer/client-certs/tls.crt",
      "clientKeyPath": "/etc/cloud-event-consumer/client-certs/tls.key",
      "caCertPath": "/etc/cloud-event-consumer/ca-bundle/service-ca.crt",
      "enableOAuth": true,
      "useOpenShiftOAuth": true,
      "oauthIssuer": "https://oauth-openshift.apps.{{CLUSTER_NAME}}",
      "oauthJWKSURL": "https://oauth-openshift.apps.{{CLUSTER_NAME}}/oauth/jwks",
      "requiredScopes": ["user:info"],
      "requiredAudience": "openshift",
      "serviceAccountName": "consumer-sa",
      "serviceAccountToken": "/var/run/secrets/kubernetes.io/serviceaccount/token"
    }
